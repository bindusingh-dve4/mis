
{% extends "base.html" %}

{% block title %}Configuration Master - MIS{% endblock %}

{% block content %}
<script>
function toggleEditCompany(companyId) {
    const editForm = document.getElementById('edit-company-form-' + companyId);
    const actionButtons = document.getElementById('action-company-buttons-' + companyId);
    
    if (editForm.classList.contains('hidden')) {
        editForm.classList.remove('hidden');
        actionButtons.classList.add('hidden');
    } else {
        editForm.classList.add('hidden');
        actionButtons.classList.remove('hidden');
    }
}

function toggleEditFY(fyId) {
    const editForm = document.getElementById('edit-fy-form-' + fyId);
    const actionButtons = document.getElementById('action-fy-buttons-' + fyId);
    
    if (editForm.classList.contains('hidden')) {
        editForm.classList.remove('hidden');
        actionButtons.classList.add('hidden');
    } else {
        editForm.classList.add('hidden');
        actionButtons.classList.remove('hidden');
    }
}
</script>
<div class="max-w-6xl mx-auto">
    <h2 class="text-3xl font-bold mb-6">Configuration Master</h2>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-bold mb-4">Companies</h3>
            <form method="POST" action="{{ url_for('add_company') }}" class="mb-4">
                <input type="text" name="company_name" placeholder="Company Name" required class="w-full px-3 py-2 border rounded mb-2">
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                    <i class="fas fa-plus mr-1"></i> Add Company
                </button>
            </form>
            <div class="space-y-2">
                {% for company in companies %}
                <div class="p-3 bg-gray-50 rounded border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium" id="company-name-{{ company.CompanyID }}">{{ company.CompanyName }}</span>
                        <form method="POST" action="{{ url_for('toggle_company', company_id=company.CompanyID) }}" class="inline">
                            <button type="submit" class="text-xs px-2 py-1 rounded {% if company.ActiveFlag %}bg-green-100 text-green-700 hover:bg-green-200{% else %}bg-red-100 text-red-700 hover:bg-red-200{% endif %}">
                                {{ 'Active' if company.ActiveFlag else 'Inactive' }}
                            </button>
                        </form>
                    </div>
                    
                    <!-- Edit Form (Hidden by default) -->
                    <form method="POST" action="{{ url_for('edit_company', company_id=company.CompanyID) }}" id="edit-company-form-{{ company.CompanyID }}" class="hidden mb-2">
                        <input type="text" name="company_name" value="{{ company.CompanyName }}" required class="w-full px-2 py-1 border rounded text-sm mb-2">
                        <div class="flex gap-2">
                            <button type="submit" class="flex-1 bg-blue-600 text-white text-xs py-1 rounded hover:bg-blue-700">
                                <i class="fas fa-save mr-1"></i> Save
                            </button>
                            <button type="button" onclick="toggleEditCompany({{ company.CompanyID }})" class="flex-1 bg-gray-400 text-white text-xs py-1 rounded hover:bg-gray-500">
                                <i class="fas fa-times mr-1"></i> Cancel
                            </button>
                        </div>
                    </form>
                    
                    <div class="flex gap-2" id="action-company-buttons-{{ company.CompanyID }}">
                        <button onclick="toggleEditCompany({{ company.CompanyID }})" class="flex-1 bg-yellow-500 text-white text-xs py-1 rounded hover:bg-yellow-600">
                            <i class="fas fa-edit mr-1"></i> Edit
                        </button>
                        <form method="POST" action="{{ url_for('delete_company', company_id=company.CompanyID) }}" class="flex-1" onsubmit="return confirm('Are you sure you want to delete {{ company.CompanyName }}?');">
                            <button type="submit" class="w-full bg-red-600 text-white text-xs py-1 rounded hover:bg-red-700">
                                <i class="fas fa-trash mr-1"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-bold mb-4">Departments</h3>
            <div class="text-center py-8">
                <i class="fas fa-building text-6xl text-blue-600 mb-4 opacity-50"></i>
                <p class="text-gray-600 mb-4">Manage all departments in a dedicated page</p>
                <a href="{{ url_for('department_management') }}" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                    <i class="fas fa-arrow-right mr-2"></i> Go to Department Management
                </a>
            </div>
            <div class="mt-4 p-3 bg-blue-50 rounded border border-blue-200">
                <p class="text-sm text-gray-700">
                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                    <strong>{{ departments|length }}</strong> department(s) configured
                </p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-bold mb-4">Financial Years</h3>
            <form method="POST" action="{{ url_for('add_fy') }}" class="mb-4">
                <input type="text" name="fy_name" placeholder="FY Name (e.g., 2024-2025)" required class="w-full px-3 py-2 border rounded mb-2">
                <input type="date" name="start_date" placeholder="Start Date" required class="w-full px-3 py-2 border rounded mb-2">
                <input type="date" name="end_date" placeholder="End Date" required class="w-full px-3 py-2 border rounded mb-2">
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Add FY</button>
            </form>
            <div class="space-y-2">
                {% for fy in financial_years %}
                <div class="p-3 bg-gray-50 rounded border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <span class="font-bold">{{ fy.FYName }}</span>
                            <p class="text-xs text-gray-600">{{ fy.StartDate }} to {{ fy.EndDate }}</p>
                        </div>
                        <form method="POST" action="{{ url_for('toggle_fy', fy_id=fy.FYID) }}" class="inline">
                            <button type="submit" class="text-xs px-2 py-1 rounded {% if fy.ActiveFlag %}bg-green-100 text-green-700 hover:bg-green-200{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                                {{ 'Active' if fy.ActiveFlag else 'Set Active' }}
                            </button>
                        </form>
                    </div>
                    
                    <!-- Edit Form (Hidden by default) -->
                    <form method="POST" action="{{ url_for('edit_fy', fy_id=fy.FYID) }}" id="edit-fy-form-{{ fy.FYID }}" class="hidden mb-2">
                        <input type="text" name="fy_name" value="{{ fy.FYName }}" required class="w-full px-2 py-1 border rounded text-sm mb-1">
                        <input type="date" name="start_date" value="{{ fy.StartDate }}" required class="w-full px-2 py-1 border rounded text-sm mb-1">
                        <input type="date" name="end_date" value="{{ fy.EndDate }}" required class="w-full px-2 py-1 border rounded text-sm mb-2">
                        <div class="flex gap-2">
                            <button type="submit" class="flex-1 bg-blue-600 text-white text-xs py-1 rounded hover:bg-blue-700">
                                <i class="fas fa-save mr-1"></i> Save
                            </button>
                            <button type="button" onclick="toggleEditFY({{ fy.FYID }})" class="flex-1 bg-gray-400 text-white text-xs py-1 rounded hover:bg-gray-500">
                                <i class="fas fa-times mr-1"></i> Cancel
                            </button>
                        </div>
                    </form>
                    
                    <div class="flex gap-2" id="action-fy-buttons-{{ fy.FYID }}">
                        <button onclick="toggleEditFY({{ fy.FYID }})" class="flex-1 bg-yellow-500 text-white text-xs py-1 rounded hover:bg-yellow-600">
                            <i class="fas fa-edit mr-1"></i> Edit
                        </button>
                        <form method="POST" action="{{ url_for('delete_fy', fy_id=fy.FYID) }}" class="flex-1" onsubmit="return confirm('Are you sure you want to delete {{ fy.FYName }}? This action cannot be undone if the FY has no associated data.');">
                            <button type="submit" class="w-full bg-red-600 text-white text-xs py-1 rounded hover:bg-red-700">
                                <i class="fas fa-trash mr-1"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
